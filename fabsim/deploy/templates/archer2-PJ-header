#!/bin/bash
#SBATCH --nodes $PJ_size

## task per node
#SBATCH --tasks-per-node=$corespernode

## wall time in format MINUTES:SECONDS
#SBATCH --time=$job_wall_time

## grant
#SBATCH --account=$budget

## stdout file
#SBATCH --output=$job_results/JobID-%j.output

## stderr file
#SBATCH --error=$job_results/JobID-%j.error

## Set the initial working directory (prevents the home directory error)
#SBATCH --chdir=$job_results

#SBATCH --partition=$partition_name
#SBATCH --qos=$qos_name

# Python environment setup
if [ -d "$virtual_env_path" ]; then
  echo "Activating virtual environment: $virtual_env_path"
  source "$virtual_env_path/bin/activate"
else
  echo "virtual_env_path not found, falling back to module system"
  module load cray-python
  export PYTHONUSERBASE="$HOME/.local"
  export PATH="$PYTHONUSERBASE/bin:$PATH"
  export PYTHONPATH="$PYTHONUSERBASE/lib/python3.9/site-packages:$PYTHONPATH"

  # Ensure qcg-pilotjob is available
  pip3 install --upgrade --user qcg-pilotjob
fi

## Execute QCG-PilotJob
$run_QCG_PilotJob
